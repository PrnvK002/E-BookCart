{"version":3,"sources":["../src/js/Trigger.js"],"names":["throwIfMissing","BoundingBox","Trigger","options","_show","bind","_hide","_handleEntry","_handleMovement","el","zoomPane","sourceAttribute","handleTouch","onShow","onHide","hoverDelay","touchDelay","hoverBoundingBox","touchBoundingBox","namespace","zoomFactor","boundingBoxContainer","passive","settings","boundingBox","containerEl","enabled","_bindEvents","event","preventDefault","_isTouchEvent","isShowing","touches","addEventListener","isPassive","_preventDefault","removeEventListener","e","_preventDefaultAllowTouchScroll","_lastMovement","type","entryTimeout","setTimeout","show","getAttribute","clientWidth","clientHeight","touchActivated","clearTimeout","hide","movementX","movementY","firstTouch","clientX","clientY","rect","getBoundingClientRect","offsetX","left","offsetY","top","percentageOffsetX","percentageOffsetY","setPosition"],"mappings":"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","sourcesContent":["import throwIfMissing from \"./util/throwIfMissing\";\nimport BoundingBox from \"./BoundingBox\";\n\nexport default class Trigger {\n  constructor(options = {}) {\n    this._show = this._show.bind(this);\n    this._hide = this._hide.bind(this);\n    this._handleEntry = this._handleEntry.bind(this);\n    this._handleMovement = this._handleMovement.bind(this);\n\n    const {\n      el = throwIfMissing(),\n      zoomPane = throwIfMissing(),\n      sourceAttribute = throwIfMissing(),\n      handleTouch = throwIfMissing(),\n      onShow = null,\n      onHide = null,\n      hoverDelay = 0,\n      touchDelay = 0,\n      hoverBoundingBox = throwIfMissing(),\n      touchBoundingBox = throwIfMissing(),\n      namespace = null,\n      zoomFactor = throwIfMissing(),\n      boundingBoxContainer = throwIfMissing(),\n      passive = false,\n    } = options;\n\n    this.settings = {\n      el,\n      zoomPane,\n      sourceAttribute,\n      handleTouch,\n      onShow,\n      onHide,\n      hoverDelay,\n      touchDelay,\n      hoverBoundingBox,\n      touchBoundingBox,\n      namespace,\n      zoomFactor,\n      boundingBoxContainer,\n      passive,\n    };\n\n    if (this.settings.hoverBoundingBox || this.settings.touchBoundingBox) {\n      this.boundingBox = new BoundingBox({\n        namespace: this.settings.namespace,\n        zoomFactor: this.settings.zoomFactor,\n        containerEl: this.settings.boundingBoxContainer,\n      });\n    }\n\n    this.enabled = true;\n\n    this._bindEvents();\n  }\n\n  get isShowing() {\n    return this.settings.zoomPane.isShowing;\n  }\n\n  _preventDefault(event) {\n    event.preventDefault();\n  }\n\n  _preventDefaultAllowTouchScroll(event) {\n    if (!this.settings.touchDelay || !this._isTouchEvent(event) || this.isShowing) {\n      event.preventDefault();\n    }\n  }\n\n  _isTouchEvent(event) {\n    return !!event.touches;\n  }\n\n  _bindEvents() {\n    this.settings.el.addEventListener(\"mouseenter\", this._handleEntry, false);\n    this.settings.el.addEventListener(\"mouseleave\", this._hide, false);\n    this.settings.el.addEventListener(\"mousemove\", this._handleMovement, false);\n\n    const isPassive = { passive: this.settings.passive };\n    if (this.settings.handleTouch) {\n      this.settings.el.addEventListener(\"touchstart\", this._handleEntry, isPassive);\n      this.settings.el.addEventListener(\"touchend\", this._hide, false);\n      this.settings.el.addEventListener(\"touchmove\", this._handleMovement, isPassive);\n    } else {\n      this.settings.el.addEventListener(\"touchstart\", this._preventDefault, isPassive);\n      this.settings.el.addEventListener(\"touchend\", this._preventDefault, false);\n      this.settings.el.addEventListener(\"touchmove\", this._preventDefault, isPassive);\n    }\n  }\n\n  _unbindEvents() {\n    this.settings.el.removeEventListener(\"mouseenter\", this._handleEntry, false);\n    this.settings.el.removeEventListener(\"mouseleave\", this._hide, false);\n    this.settings.el.removeEventListener(\"mousemove\", this._handleMovement, false);\n\n    if (this.settings.handleTouch) {\n      this.settings.el.removeEventListener(\"touchstart\", this._handleEntry, false);\n      this.settings.el.removeEventListener(\"touchend\", this._hide, false);\n      this.settings.el.removeEventListener(\"touchmove\", this._handleMovement, false);\n    } else {\n      this.settings.el.removeEventListener(\"touchstart\", this._preventDefault, false);\n      this.settings.el.removeEventListener(\"touchend\", this._preventDefault, false);\n      this.settings.el.removeEventListener(\"touchmove\", this._preventDefault, false);\n    }\n  }\n\n  _handleEntry(e) {\n    this._preventDefaultAllowTouchScroll(e);\n    this._lastMovement = e;\n\n    if (e.type == \"mouseenter\" && this.settings.hoverDelay) {\n      this.entryTimeout = setTimeout(this._show, this.settings.hoverDelay);\n    } else if (this.settings.touchDelay) {\n      this.entryTimeout = setTimeout(this._show, this.settings.touchDelay);\n    } else {\n      this._show();\n    }\n  }\n\n  _show() {\n    if (!this.enabled) {\n      return;\n    }\n\n    const onShow = this.settings.onShow;\n    if (onShow && typeof onShow === \"function\") {\n      onShow();\n    }\n\n    this.settings.zoomPane.show(\n      this.settings.el.getAttribute(this.settings.sourceAttribute),\n      this.settings.el.clientWidth,\n      this.settings.el.clientHeight\n    );\n\n    if (this._lastMovement) {\n      const touchActivated = this._lastMovement.touches;\n      if ((touchActivated && this.settings.touchBoundingBox) || (!touchActivated && this.settings.hoverBoundingBox)) {\n        this.boundingBox.show(this.settings.zoomPane.el.clientWidth, this.settings.zoomPane.el.clientHeight);\n      }\n    }\n\n    this._handleMovement();\n  }\n\n  _hide(e) {\n    if (e) {\n      this._preventDefaultAllowTouchScroll(e);\n    }\n\n    this._lastMovement = null;\n\n    if (this.entryTimeout) {\n      clearTimeout(this.entryTimeout);\n    }\n\n    if (this.boundingBox) {\n      this.boundingBox.hide();\n    }\n\n    const onHide = this.settings.onHide;\n    if (onHide && typeof onHide === \"function\") {\n      onHide();\n    }\n\n    this.settings.zoomPane.hide();\n  }\n\n  _handleMovement(e) {\n    if (e) {\n      this._preventDefaultAllowTouchScroll(e);\n      this._lastMovement = e;\n    } else if (this._lastMovement) {\n      e = this._lastMovement;\n    } else {\n      return;\n    }\n\n    let movementX;\n    let movementY;\n\n    if (e.touches) {\n      const firstTouch = e.touches[0];\n      movementX = firstTouch.clientX;\n      movementY = firstTouch.clientY;\n    } else {\n      movementX = e.clientX;\n      movementY = e.clientY;\n    }\n\n    const el = this.settings.el;\n    const rect = el.getBoundingClientRect();\n    const offsetX = movementX - rect.left;\n    const offsetY = movementY - rect.top;\n\n    const percentageOffsetX = offsetX / this.settings.el.clientWidth;\n    const percentageOffsetY = offsetY / this.settings.el.clientHeight;\n\n    if (this.boundingBox) {\n      this.boundingBox.setPosition(percentageOffsetX, percentageOffsetY, rect);\n    }\n\n    this.settings.zoomPane.setPosition(percentageOffsetX, percentageOffsetY, rect);\n  }\n}\n"],"file":"Trigger.js"}